{"title":"Aula 6 e 7","markdown":{"yaml":{"title":"Aula 6 e 7","format":"html","editor":"visual","massage":false,"warning":false},"headingText":"Objetivo","containsRefs":false,"markdown":"\n\n\nAprender a realizar Análise de Variância (ANOVA) e testar suas premissas, testes de comparações múltiplas, transformações de dados, testes não-paramétricos, Modelos Lineares Generalizados (GLMs) e Anova Fatorial.\n\n# Pacotes\n\nPacotes requeridos no decorrer do código.\n\n```{r message=FALSE, warning=FALSE}\nlibrary(tidyverse)    # Manipulação de dados\nlibrary(report)       # possui uma função interessante para retornar o um resumo do                         resultado estatístico\nlibrary(emmeans)\nlibrary(multcomp)\nlibrary(multcompView)\nlibrary(DHARMa)\nlibrary(performance)  # Testar as premissas\nlibrary(agricolae)\n```\n\n# Banco de dados: Dois grupos independentes\n\nO banco de dados é constituído por dois tratamentos, controle e Mg e uma variável resposta '*comp'*.\n\n```{r}\ndados <- gsheet::gsheet2tbl(url = 'https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=983033137')\n```\n\n## Gráfico\n\nVisualizando os dados dos tratamentos por meio de Boxplot. Já é possível inferir que há diferença entre os tratamentos. Para ter certeza se essa diferença realmente existe, vamos seguir analisando.\n\n```{r}\ndados |> \n  ggplot(aes(trat, comp)) +\n  geom_boxplot(fill = 'lightblue') + \n  labs(x = 'Treatments') +\n  theme_classic() +\n  labs(y = 'Comprimento')\n```\n\n## Teste t de Student\n\nO teste t de Student é um teste de análise paramétrica e pode ser dividido em três tipos:\n\n-   Teste t de **amostras independentes**: Quando se deseja comparar diferença entre médias de dois tratamentos;\n\n-   Teste t de **amostras dependentes** ou pareadas: Quando se deseja comparar diferenças sobre um mesmo grupo antes e depois da aplicação do tratamento;\n\n-   Teste t de **uma amostra**: Quando se deseja comparar a média do grupo com uma determinado valor conhecido.\n\nReestruturando banco de dados para o formato largo e realizando o teste t utilizando as funções `pivot_wider()` e `t.test()` dos pacotes **tidyr** e **stats**, respectivamente. Por fim, a função `report()`, do pacote **report,** retorna um resumo do resultado do teste. De maneira geral, o teste apresentou diferença significativa entre os dois tratamentos com p-valor \\< 0,05.\n\n```{r}\ndados <- dados |> \n  pivot_wider(names_from = trat, values_from = comp)\n\nteste <- t.test(dados$Mg2, dados$control)\nreport(teste)\n```\n\n## Premissas\n\nAntes de prosseguir com análise paramétrica dos dados, é necessário que os dados atendam as premissas de **Normalidade dos Dados** e **Homogeneidade de Variâncias**.\n\n### Normalidade\n\nO teste de normalidade adotado aqui é o teste de **Shapiro-Wilk**. Existem outros testes de normalidade que podem ser utilizados. No entanto, esse teste é considerado o mais poderoso entre os testes. Pode ser feito da seguinte maneira:\n\n```{r}\nshapiro.test(dados$Mg2)\n```\n\n```{r}\nshapiro.test(dados$control)\n```\n\nObserve que a normalidade foi testada para cada tratamento e o p-valor \\> 0,05. Dessa maneira, não se rejeita a hipótese nula (H0), que os dados são normais.\n\n#### Gráfico de normalidade\n\nO código abaixo, apresenta graficamente a normalidade dos dados. Nesse caso, testamos a normalidade para o vetor de valores do tratamento Mg. A interpretação do gráfico é que quanto mais próximo os pontos estão da reta, ou, quanto menor esse erro dos pontos em relação a reta, mais próximo da normalidade estão os dados.\n\n```{r}\nqqnorm(dados$Mg2)\nqqline(dados$Mg2)\n```\n\n### Homogeneidade de variâncias\n\nA função `var.test()` do pacote **stats** pode ser utilizada para análise de variâncias. A função pede como argumento basicamente 2 vetores numéricos, cada um com os valores da variável resposta de cada um dos tratamentos.\n\n```{r}\nvar.test(dados$Mg2, dados$control)\n```\n\nCaso as variâncias não sejam homogêneas, pode-se acrescentar o argumento:\n\n```{r}\nt.test(dados$Mg2, dados$control, var.equal = FALSE)\n```\n\nAcabamos de verificar as premissas de normalidade dos dados e homogeneidade das variâncias.\n\n# Banco de dados: Dois grupos com dependência\n\nOs dados que trabalharemos agora são referentes a avaliações de intensidade de doença sem e com auxílio de escala diagramática. Nesse caso, os dados são coletados sobre o mesmo avaliador em momentos diferentes. No primeiro momento, o avaliador não faz uso de escala. No segundo momento, o avaliador faz uso de escala. O objetivo aqui é analisar se há ganho em acurácia e precisão quando se adota a escala comparado a quando não há. Nesse sentido, dizemos que existe dependência entre os dados e seguimos com teste t pareado.\n\n```{r}\ndados2 <- gsheet::gsheet2tbl('https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=1729131173')\n```\n\n## Gráfico\n\n```{r}\ndados2 |> \n  ggplot(aes(assessment, acuracia)) +\n  geom_boxplot(fill = 'lightblue') + \n  labs(y = \"Acurácia\",\n       x = 'Avaliação') +\n  theme_classic() +\n  theme(text = element_text(size = 15)) \n  \n```\n\n## Teste t pareado\n\nSeguindo o mesmo raciocínio utilizado no banco de dados anterior, para este, também será ajustado para o formato largo antes de seguir com a análise.\n\nPara realizar o teste entre grupos pareados (dependentes), basta acrescentar o argumento `paired = TRUE` dentro da função `t.test()`.\n\n```{r}\ndados2 <- dados2 |> \n  dplyr::select(rater, assessment, acuracia)\n\ndados2 <-  dados2 |> \n  pivot_wider(names_from = assessment, values_from = acuracia)\n\n\nt.test(dados2$Unaided, dados2$Aided1, paired = TRUE)\n```\n\nO p-valor \\< 0,05, rejeita-se H0 e aceita-se a hipótese alternativa (Ha), ou seja, existe diferença significativa entre os grupos de médias ao nível de 5% de probabilidade, pelo teste t pareado. Agora, é preciso verificar as premissas antes de aceitar este resultado como verdade.\n\n## Premissas\n\n### Normalidade\n\n```{r}\nshapiro.test(dados2$Unaided)\nshapiro.test(dados2$Aided1)\n```\n\nPelo menos um dos grupos não apresentou normalidade dos dados.\n\n### Homogeneidade de variâncias\n\n```{r}\nvar.test(dados2$Unaided, dados2$Aided1)\n```\n\nAs variâncias não podem ser consideradas homogêneas. P-valor \\> 0,05. Os dados foram submetidos a transformações e mesmo assim não atenderam as premissas. Nesse caso, para prosseguir com a análise dos dados é preciso partir para análise não paramétrica, que será abordada mais adiante.\n\nNo entanto, supondo que os dados são normais e apenas a premissa de homogeneidade de variâncias não foi atendida, pode-se seguir com a análise do teste t indicando o argumento *`var.equal = FALSE`* dentro da função `t.test()`. Esse teste é uma variação do teste t e é conhecido com teste t de Welch.\n\n```{r}\nt.test(dados2$Unaided, dados2$Aided1, paired = TRUE, var.equal = FALSE)\n```\n\n# Teste não-paramétrico\n\nSeguindo com a análise do conjunto de dados anterior, adotar teste não-paramétrico é uma alternativa para seguir com as análises quando as premissas dos testes paramétricos não são atendidas.\n\n## Wilcoxon Signed-Rank\n\nEsse teste é uma alternativa não-paramétrica para análise de dados pareados que não apresentam normalidade. Utilizando a função `wilcox.test()` e definindo o argumento *`paired = TRUE`\"*.\n\n```{r}\nwilcox.test(dados2$Aided1,\n            dados2$Unaided,\n            paired = TRUE)\n```\n\nO p-valor \\< 0,05, indicando que existe diferença entre os tratamentos pelo referido teste.\n\n# Banco de dados: Três ou mais grupos\n\nAgora vamos seguir para analisar dados cujas comparações são entre três ou mais grupos. Os dados importados abaixo são referentes a um ensaio conduzido num Delineamento experimental Inteiramente Casualizado (DIC), com 5 tratamentos (espécies) e 6 repetições com apenas uma variável resposta.\n\n```{r}\ndados3 <- gsheet::gsheet2tbl('https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=959387827')\n```\n\n## Gráfico\n\n```{r}\ndados3 |> \n  ggplot(aes(especie, tcm)) +\n  geom_boxplot(fill = 'grey') +\n  geom_jitter(width = 0.1, size = 2.5, alpha = 0.7, color = 'darkred') +\n  labs(x = 'Espécies') +\n  theme_classic()\n```\n\n## ANOVA\n\nA ANOVA (Análise de Variância), identifica a existência de pelo menos uma média com diferença significativa entre as demais. No entanto, ela por si só, não indica quais médias são diferentes entre si. A hipótese testada é que as médias são iguais. O quadro de ANOVA retorna o p-valor e este sendo menor que o nível de significancia adotado pelo pesquisador, rejeita-se a H0 e aceita-se a Ha. Para realizar essa análise no R, pode-se seguir com as funções `anova()` e `lm()` do pacote **stats**. Para entender melhor sobre como utilizar essas funções e seus argumentos, busque ajuda digitando no console *`?NOME DA FUNÇÃO`*.\n\n```{r}\nanova(lm(tcm ~ especie, data = dados3))\n```\n\nO resultado do Quadro da ANOVA indicou que existe pelo menos uma média, entre os tratamentos, que se diferem entre si ao nível de 5% de significância.\n\n## Teste de comparações múltiplas\n\nUtilizando a função `emmeans()` e `cld()` para separar os grupos de médias estatisticamente diferentes entre si.\n\n```{r}\nm1 <- lm(tcm ~ especie, data = dados3)\nmedias1 <-  emmeans(m1, ~ especie)\ncld(medias1, Letters = letters)\n```\n\n## Premissas: normalidades dos resíduos\n\nA seguir, três maneiras de verificar as premissas.\n\n-   **Primeira maneira**: Utilizando as funções `shapiro.test()` e `bartlett.test()`.\n\nOs resíduos são normais e as variâncias são homeogêneas.\n\n```{r}\nshapiro.test(m1$residuals)\nbartlett.test(tcm ~ especie, data = dados3)\n```\n\n-   **Segunda maneira:** Realizando o plot do resultado da função `simulateResiduals()` do modelo ajustado, nesse caso, 'm1'. Os resíduos são normais e as variências homogêneas.\n\n```{r}\nplot(simulateResiduals(m1))\n```\n\n-   **Terceira maneira:** Utilizando aa fuções `check_normality()` e `check_heteroscedasticity()` do pacote **Performance**, para verificar a normalidade dos resíduos e homeogeneidade das variâncias, respectivamente.\n\n```{r}\ncheck_normality(m1)\ncheck_heteroscedasticity(m1)\nplot <- check_model(m1)\n```\n\n# Banco de dados\n\nO banco de dados contêm 6 tratamentos com 12 repetições cada.\n\n```{r}\ninsects <- InsectSprays\ninsects |> count(spray)\n```\n\n## Gráfico\n\nApenas com base no gráfico abaixo, podemos inferir que existe tratamentos que diferem entre si sobre a variável contagem. Vamos realizar os teste estatísticos para ter certeza disso.\n\n```{r}\ninsects |> \n  ggplot(aes(x = spray, y = count)) +\n  geom_boxplot(outlier.colour = NA, fill = 'lightblue') +\n  geom_jitter(width = 0.05, color = 'gray') + \n  labs(x = 'Spray', y = 'Contagem') +  \n  theme_classic()\n```\n\n## ANOVA\n\nEsses dados são referentes a um ensaio realizado em Delineamento Inteiramente Casualizado (DIC). Logo, o ajuste do modelo, para rodar a ANOVA, é simples. Como apresentado no código abaixo:\n\n```{r}\nml <- lm(count ~ spray, \n         data = insects)\nanova(ml)\n```\n\nO p-valor \\< 0,05, ou seja, existe pelo menos um par de médias que se diferem entre si, pelo teste F, ao nível de 5% de probabilidade.\n\n## Gráfico: Histograma dos resíduos\n\nCom base no gráfico abaixo, é perceptível que os resíduos têm uma distribuição normal. Seguimos agora com um teste de normalidade para confirmar essa ideia.\n\n```{r}\ninsects |> \n  ggplot(aes(x = ml$residuals)) +\n  geom_histogram(bins = 10, color = 'white', fill = 'lightblue') + \n  labs(x = 'Resíduos') +\n  theme_classic()\n```\n\n```{r}\nshapiro.test(ml$residuals)\n```\n\nO teste indica não normalidade dos dados, apesar de visualmente o histograma apresentar uma certa normalidade. Vale lembrar que a homogeneidade das variâncias é mais importanque que a normalidade dos resíduos.\n\n```{r}\nbartlett.test(count ~ spray, \n              data = insects)\n```\n\nDe acordo com o teste de Bartlett os dados possuem variâncias heterogêneas. Resumindo, não é possível aplicar estatística paramétrica. Parte-se agora para transformação de dados para verificar se é possível trabalhar com estatística paramétrica com esses dados.\n\nQuando os dados são de contagem, normalmente a transformação com base na raiz quadrada é interessante.\n\n## Alternativa 1: transformação\n\n### Transformação por raiz quadrada\n\n```{r}\ninsects <- insects |> \n  mutate(count2 = sqrt(count))\n\ninsects |> \n  ggplot(aes(x = spray, y = count2)) +\n  geom_boxplot(fill = 'lightblue') +\n  theme_classic() +\n  labs(y = 'Count \\n (transformação pela raiz quadrada)', x = 'Spray')\n```\n\nSeguimos agora para testar as premissas utilizando os dados transformados.\n\n```{r}\nml <- lm(count2 ~ spray,\n         data = insects)\nanova(ml)\n# Uma maneira de testear as premissas\nshapiro.test(ml$residuals)\nbartlett.test(count2 ~ spray,\n              data = insects)\n\n# Outra maneira de testar as premissas\ncheck_normality(ml)\ncheck_heteroscedasticity(ml)\n\n```\n\nPremissas atendidas com a transformação por raiz quadrada. Partimos para testes de comparações múltiplas:\n\n```{r}\nmedias1 <-  emmeans(ml, ~ spray)\ncld(medias1, Letters = letters)\n```\n\nConcluimos que os fungicidas C e E são os mais eficazes.\n\n### Transformação Box-Cox\n\nOutra maneira de transformar os dados é por meio da transformação de Box-Cox. Para isso, primeiro é preciso encontrar o lambda.\n\n```{r}\nlibrary(MASS)\n\nb <-  boxcox(lm(insects$count + 0.1 ~ 1))\nlambda <- b$x[which.max(b$y)]\nlambda\n```\n\nCriando a variável transformada conforme a equação:\n\n-   y(lambda) = (x\\^lambda - 1) / lambda.\n\n```{r}\ninsects$count3 <- (insects$count ^ lambda - 1) / lambda\n\n```\n\n## Alternativa 2: Teste não paramétrico\n\nCaso, após as transformações, os dados ainda não atendam as premissas de normalidade e homogeneidade de variâncias, podemos seguir com análise não-paramétrica. Testes não-paramétricos não consideram as premissas antes testadas e permitem que prossigamos com a análise dos dados.\n\nO teste de [Kruskal-Wallis](https://rcompanion.org/handbook/F_08.html) é um teste não paramétrico similar ao teste F. Portanto, o teste não separa os grupos. Para isso, após o teste apresentar que há pelo menos um par de tratamentos que se diferem estatisticamente entre si, é necessário adotar um teste Post Hoc, para comparações múltiplas. A função `kruskal.test()`, do pacote **stats**, realiza essa primeira parte. A função `kruskal()` do pacote **agricolae,** realiza essas duas etapas de uma vez. Caso queira, pode-se realizar testes Post Hoc como o teste de Dunn, teste de Nemenyi ou teste de Conover.\n\n```{r}\nkruskal.test(count ~ spray, data = insects)\n```\n\n```{r}\nm3 <- kruskal(insects$count, insects$spray, group = T)\nm3$groups\n```\n\n## Alternativa 3: Modelo linear generalizado (GLMs)\n\nOutra alternativa que se pode adotar, para análisar dados que não atenderam as premissas, é realizar ajustes de modelos não lineares, que permite indicar a qual distribuição os dados pertencem. A função `glm()` do pacote **stats**, ajusta esses modelos.\n\n```{r}\nm4 <- glm(count ~ spray, \n          family = poisson, # poisson por ser dados de contagem\n          data = insects)\nsummary(m4)\n\nlibrary(car)\nAnova(m4)\n\n```\n\nP-valor \\< 0,05, um indicativo que existe pelo menos uma média com diferença significativa. Agora para separar os grupos seguimos com testes de comparações múltiplas.\n\n```{r}\nmedias4 <-  emmeans(m4, ~ spray,\n                    type = \"response\")\ncld(medias4, Letters = letters)\n\n```\n\n# Anova Fatorial\n\nPartimos agora para análise de dados organizados em esquema fatorial.\n\n## Banco de dados\n\nDados referentes a um ensaio realizado em Delineamento Inteiramente Casualizado (DIC) em esquema fatorial 2x2. O primeiro fator, qualitativo, composto pelos níveis: Líquido iônico e Tebuconazol. O segundo fator, quantitativo, composto pelos níveis: 0,5 e 2. Avaliou-se o efeito dos tratamentos sobre a intensidade de uma doença qualquer.\n\n```{r}\ndados <- gsheet::gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=2023059672\")\n```\n\n## Gráfico\n\nVisualmente, é perceptível uma diferença do tratamento líquido iônico na concentração de 0,2 com os outros tratamentos.\n\n```{r}\ndados |> \n  ggplot(aes(factor(dose), x = treat, y = severity, color = factor(dose))) + \n  geom_jitter(size = 3, width = 0.2) +\n  theme_classic() + \n  labs(y = 'Severidade (%)', x = ' ', color = 'Doses') +\n  theme(text = element_text(size = 15))\n```\n\n# ANOVA e teste de comparações múltiplas\n\nVamos rodar os testes para verificar se realmente existe essa diferença detectada visualmente no gráfico. Nesse caso, ajustamos o modelo como se segue:\n\n```{r}\nmf <- lm(severity ~ treat*factor(dose), data = dados )\nanova(mf)\nplot(simulateResiduals(mf))\nmf_medias1 <- cld(emmeans(mf, ~ treat | dose))\nmf_medias2 <- cld(emmeans(mf, ~ dose | treat))\n\nmf_medias1; mf_medias2\n```\n\nComo visualizado no gráfico de dispersão, existe diferença entre os níveis de dose dentro do fator líquido iônico e diferença entre os níveis qualitativos dentro do nível 0,5 do fator dose. Concluindo que a aplicação do líquido iônico é equivalente a aplicação de fungicida tebuconazol quando aplicado na dose 2, sobre a redução da severidade da doença.\n","srcMarkdownNoYaml":"\n\n# Objetivo\n\nAprender a realizar Análise de Variância (ANOVA) e testar suas premissas, testes de comparações múltiplas, transformações de dados, testes não-paramétricos, Modelos Lineares Generalizados (GLMs) e Anova Fatorial.\n\n# Pacotes\n\nPacotes requeridos no decorrer do código.\n\n```{r message=FALSE, warning=FALSE}\nlibrary(tidyverse)    # Manipulação de dados\nlibrary(report)       # possui uma função interessante para retornar o um resumo do                         resultado estatístico\nlibrary(emmeans)\nlibrary(multcomp)\nlibrary(multcompView)\nlibrary(DHARMa)\nlibrary(performance)  # Testar as premissas\nlibrary(agricolae)\n```\n\n# Banco de dados: Dois grupos independentes\n\nO banco de dados é constituído por dois tratamentos, controle e Mg e uma variável resposta '*comp'*.\n\n```{r}\ndados <- gsheet::gsheet2tbl(url = 'https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=983033137')\n```\n\n## Gráfico\n\nVisualizando os dados dos tratamentos por meio de Boxplot. Já é possível inferir que há diferença entre os tratamentos. Para ter certeza se essa diferença realmente existe, vamos seguir analisando.\n\n```{r}\ndados |> \n  ggplot(aes(trat, comp)) +\n  geom_boxplot(fill = 'lightblue') + \n  labs(x = 'Treatments') +\n  theme_classic() +\n  labs(y = 'Comprimento')\n```\n\n## Teste t de Student\n\nO teste t de Student é um teste de análise paramétrica e pode ser dividido em três tipos:\n\n-   Teste t de **amostras independentes**: Quando se deseja comparar diferença entre médias de dois tratamentos;\n\n-   Teste t de **amostras dependentes** ou pareadas: Quando se deseja comparar diferenças sobre um mesmo grupo antes e depois da aplicação do tratamento;\n\n-   Teste t de **uma amostra**: Quando se deseja comparar a média do grupo com uma determinado valor conhecido.\n\nReestruturando banco de dados para o formato largo e realizando o teste t utilizando as funções `pivot_wider()` e `t.test()` dos pacotes **tidyr** e **stats**, respectivamente. Por fim, a função `report()`, do pacote **report,** retorna um resumo do resultado do teste. De maneira geral, o teste apresentou diferença significativa entre os dois tratamentos com p-valor \\< 0,05.\n\n```{r}\ndados <- dados |> \n  pivot_wider(names_from = trat, values_from = comp)\n\nteste <- t.test(dados$Mg2, dados$control)\nreport(teste)\n```\n\n## Premissas\n\nAntes de prosseguir com análise paramétrica dos dados, é necessário que os dados atendam as premissas de **Normalidade dos Dados** e **Homogeneidade de Variâncias**.\n\n### Normalidade\n\nO teste de normalidade adotado aqui é o teste de **Shapiro-Wilk**. Existem outros testes de normalidade que podem ser utilizados. No entanto, esse teste é considerado o mais poderoso entre os testes. Pode ser feito da seguinte maneira:\n\n```{r}\nshapiro.test(dados$Mg2)\n```\n\n```{r}\nshapiro.test(dados$control)\n```\n\nObserve que a normalidade foi testada para cada tratamento e o p-valor \\> 0,05. Dessa maneira, não se rejeita a hipótese nula (H0), que os dados são normais.\n\n#### Gráfico de normalidade\n\nO código abaixo, apresenta graficamente a normalidade dos dados. Nesse caso, testamos a normalidade para o vetor de valores do tratamento Mg. A interpretação do gráfico é que quanto mais próximo os pontos estão da reta, ou, quanto menor esse erro dos pontos em relação a reta, mais próximo da normalidade estão os dados.\n\n```{r}\nqqnorm(dados$Mg2)\nqqline(dados$Mg2)\n```\n\n### Homogeneidade de variâncias\n\nA função `var.test()` do pacote **stats** pode ser utilizada para análise de variâncias. A função pede como argumento basicamente 2 vetores numéricos, cada um com os valores da variável resposta de cada um dos tratamentos.\n\n```{r}\nvar.test(dados$Mg2, dados$control)\n```\n\nCaso as variâncias não sejam homogêneas, pode-se acrescentar o argumento:\n\n```{r}\nt.test(dados$Mg2, dados$control, var.equal = FALSE)\n```\n\nAcabamos de verificar as premissas de normalidade dos dados e homogeneidade das variâncias.\n\n# Banco de dados: Dois grupos com dependência\n\nOs dados que trabalharemos agora são referentes a avaliações de intensidade de doença sem e com auxílio de escala diagramática. Nesse caso, os dados são coletados sobre o mesmo avaliador em momentos diferentes. No primeiro momento, o avaliador não faz uso de escala. No segundo momento, o avaliador faz uso de escala. O objetivo aqui é analisar se há ganho em acurácia e precisão quando se adota a escala comparado a quando não há. Nesse sentido, dizemos que existe dependência entre os dados e seguimos com teste t pareado.\n\n```{r}\ndados2 <- gsheet::gsheet2tbl('https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=1729131173')\n```\n\n## Gráfico\n\n```{r}\ndados2 |> \n  ggplot(aes(assessment, acuracia)) +\n  geom_boxplot(fill = 'lightblue') + \n  labs(y = \"Acurácia\",\n       x = 'Avaliação') +\n  theme_classic() +\n  theme(text = element_text(size = 15)) \n  \n```\n\n## Teste t pareado\n\nSeguindo o mesmo raciocínio utilizado no banco de dados anterior, para este, também será ajustado para o formato largo antes de seguir com a análise.\n\nPara realizar o teste entre grupos pareados (dependentes), basta acrescentar o argumento `paired = TRUE` dentro da função `t.test()`.\n\n```{r}\ndados2 <- dados2 |> \n  dplyr::select(rater, assessment, acuracia)\n\ndados2 <-  dados2 |> \n  pivot_wider(names_from = assessment, values_from = acuracia)\n\n\nt.test(dados2$Unaided, dados2$Aided1, paired = TRUE)\n```\n\nO p-valor \\< 0,05, rejeita-se H0 e aceita-se a hipótese alternativa (Ha), ou seja, existe diferença significativa entre os grupos de médias ao nível de 5% de probabilidade, pelo teste t pareado. Agora, é preciso verificar as premissas antes de aceitar este resultado como verdade.\n\n## Premissas\n\n### Normalidade\n\n```{r}\nshapiro.test(dados2$Unaided)\nshapiro.test(dados2$Aided1)\n```\n\nPelo menos um dos grupos não apresentou normalidade dos dados.\n\n### Homogeneidade de variâncias\n\n```{r}\nvar.test(dados2$Unaided, dados2$Aided1)\n```\n\nAs variâncias não podem ser consideradas homogêneas. P-valor \\> 0,05. Os dados foram submetidos a transformações e mesmo assim não atenderam as premissas. Nesse caso, para prosseguir com a análise dos dados é preciso partir para análise não paramétrica, que será abordada mais adiante.\n\nNo entanto, supondo que os dados são normais e apenas a premissa de homogeneidade de variâncias não foi atendida, pode-se seguir com a análise do teste t indicando o argumento *`var.equal = FALSE`* dentro da função `t.test()`. Esse teste é uma variação do teste t e é conhecido com teste t de Welch.\n\n```{r}\nt.test(dados2$Unaided, dados2$Aided1, paired = TRUE, var.equal = FALSE)\n```\n\n# Teste não-paramétrico\n\nSeguindo com a análise do conjunto de dados anterior, adotar teste não-paramétrico é uma alternativa para seguir com as análises quando as premissas dos testes paramétricos não são atendidas.\n\n## Wilcoxon Signed-Rank\n\nEsse teste é uma alternativa não-paramétrica para análise de dados pareados que não apresentam normalidade. Utilizando a função `wilcox.test()` e definindo o argumento *`paired = TRUE`\"*.\n\n```{r}\nwilcox.test(dados2$Aided1,\n            dados2$Unaided,\n            paired = TRUE)\n```\n\nO p-valor \\< 0,05, indicando que existe diferença entre os tratamentos pelo referido teste.\n\n# Banco de dados: Três ou mais grupos\n\nAgora vamos seguir para analisar dados cujas comparações são entre três ou mais grupos. Os dados importados abaixo são referentes a um ensaio conduzido num Delineamento experimental Inteiramente Casualizado (DIC), com 5 tratamentos (espécies) e 6 repetições com apenas uma variável resposta.\n\n```{r}\ndados3 <- gsheet::gsheet2tbl('https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=959387827')\n```\n\n## Gráfico\n\n```{r}\ndados3 |> \n  ggplot(aes(especie, tcm)) +\n  geom_boxplot(fill = 'grey') +\n  geom_jitter(width = 0.1, size = 2.5, alpha = 0.7, color = 'darkred') +\n  labs(x = 'Espécies') +\n  theme_classic()\n```\n\n## ANOVA\n\nA ANOVA (Análise de Variância), identifica a existência de pelo menos uma média com diferença significativa entre as demais. No entanto, ela por si só, não indica quais médias são diferentes entre si. A hipótese testada é que as médias são iguais. O quadro de ANOVA retorna o p-valor e este sendo menor que o nível de significancia adotado pelo pesquisador, rejeita-se a H0 e aceita-se a Ha. Para realizar essa análise no R, pode-se seguir com as funções `anova()` e `lm()` do pacote **stats**. Para entender melhor sobre como utilizar essas funções e seus argumentos, busque ajuda digitando no console *`?NOME DA FUNÇÃO`*.\n\n```{r}\nanova(lm(tcm ~ especie, data = dados3))\n```\n\nO resultado do Quadro da ANOVA indicou que existe pelo menos uma média, entre os tratamentos, que se diferem entre si ao nível de 5% de significância.\n\n## Teste de comparações múltiplas\n\nUtilizando a função `emmeans()` e `cld()` para separar os grupos de médias estatisticamente diferentes entre si.\n\n```{r}\nm1 <- lm(tcm ~ especie, data = dados3)\nmedias1 <-  emmeans(m1, ~ especie)\ncld(medias1, Letters = letters)\n```\n\n## Premissas: normalidades dos resíduos\n\nA seguir, três maneiras de verificar as premissas.\n\n-   **Primeira maneira**: Utilizando as funções `shapiro.test()` e `bartlett.test()`.\n\nOs resíduos são normais e as variâncias são homeogêneas.\n\n```{r}\nshapiro.test(m1$residuals)\nbartlett.test(tcm ~ especie, data = dados3)\n```\n\n-   **Segunda maneira:** Realizando o plot do resultado da função `simulateResiduals()` do modelo ajustado, nesse caso, 'm1'. Os resíduos são normais e as variências homogêneas.\n\n```{r}\nplot(simulateResiduals(m1))\n```\n\n-   **Terceira maneira:** Utilizando aa fuções `check_normality()` e `check_heteroscedasticity()` do pacote **Performance**, para verificar a normalidade dos resíduos e homeogeneidade das variâncias, respectivamente.\n\n```{r}\ncheck_normality(m1)\ncheck_heteroscedasticity(m1)\nplot <- check_model(m1)\n```\n\n# Banco de dados\n\nO banco de dados contêm 6 tratamentos com 12 repetições cada.\n\n```{r}\ninsects <- InsectSprays\ninsects |> count(spray)\n```\n\n## Gráfico\n\nApenas com base no gráfico abaixo, podemos inferir que existe tratamentos que diferem entre si sobre a variável contagem. Vamos realizar os teste estatísticos para ter certeza disso.\n\n```{r}\ninsects |> \n  ggplot(aes(x = spray, y = count)) +\n  geom_boxplot(outlier.colour = NA, fill = 'lightblue') +\n  geom_jitter(width = 0.05, color = 'gray') + \n  labs(x = 'Spray', y = 'Contagem') +  \n  theme_classic()\n```\n\n## ANOVA\n\nEsses dados são referentes a um ensaio realizado em Delineamento Inteiramente Casualizado (DIC). Logo, o ajuste do modelo, para rodar a ANOVA, é simples. Como apresentado no código abaixo:\n\n```{r}\nml <- lm(count ~ spray, \n         data = insects)\nanova(ml)\n```\n\nO p-valor \\< 0,05, ou seja, existe pelo menos um par de médias que se diferem entre si, pelo teste F, ao nível de 5% de probabilidade.\n\n## Gráfico: Histograma dos resíduos\n\nCom base no gráfico abaixo, é perceptível que os resíduos têm uma distribuição normal. Seguimos agora com um teste de normalidade para confirmar essa ideia.\n\n```{r}\ninsects |> \n  ggplot(aes(x = ml$residuals)) +\n  geom_histogram(bins = 10, color = 'white', fill = 'lightblue') + \n  labs(x = 'Resíduos') +\n  theme_classic()\n```\n\n```{r}\nshapiro.test(ml$residuals)\n```\n\nO teste indica não normalidade dos dados, apesar de visualmente o histograma apresentar uma certa normalidade. Vale lembrar que a homogeneidade das variâncias é mais importanque que a normalidade dos resíduos.\n\n```{r}\nbartlett.test(count ~ spray, \n              data = insects)\n```\n\nDe acordo com o teste de Bartlett os dados possuem variâncias heterogêneas. Resumindo, não é possível aplicar estatística paramétrica. Parte-se agora para transformação de dados para verificar se é possível trabalhar com estatística paramétrica com esses dados.\n\nQuando os dados são de contagem, normalmente a transformação com base na raiz quadrada é interessante.\n\n## Alternativa 1: transformação\n\n### Transformação por raiz quadrada\n\n```{r}\ninsects <- insects |> \n  mutate(count2 = sqrt(count))\n\ninsects |> \n  ggplot(aes(x = spray, y = count2)) +\n  geom_boxplot(fill = 'lightblue') +\n  theme_classic() +\n  labs(y = 'Count \\n (transformação pela raiz quadrada)', x = 'Spray')\n```\n\nSeguimos agora para testar as premissas utilizando os dados transformados.\n\n```{r}\nml <- lm(count2 ~ spray,\n         data = insects)\nanova(ml)\n# Uma maneira de testear as premissas\nshapiro.test(ml$residuals)\nbartlett.test(count2 ~ spray,\n              data = insects)\n\n# Outra maneira de testar as premissas\ncheck_normality(ml)\ncheck_heteroscedasticity(ml)\n\n```\n\nPremissas atendidas com a transformação por raiz quadrada. Partimos para testes de comparações múltiplas:\n\n```{r}\nmedias1 <-  emmeans(ml, ~ spray)\ncld(medias1, Letters = letters)\n```\n\nConcluimos que os fungicidas C e E são os mais eficazes.\n\n### Transformação Box-Cox\n\nOutra maneira de transformar os dados é por meio da transformação de Box-Cox. Para isso, primeiro é preciso encontrar o lambda.\n\n```{r}\nlibrary(MASS)\n\nb <-  boxcox(lm(insects$count + 0.1 ~ 1))\nlambda <- b$x[which.max(b$y)]\nlambda\n```\n\nCriando a variável transformada conforme a equação:\n\n-   y(lambda) = (x\\^lambda - 1) / lambda.\n\n```{r}\ninsects$count3 <- (insects$count ^ lambda - 1) / lambda\n\n```\n\n## Alternativa 2: Teste não paramétrico\n\nCaso, após as transformações, os dados ainda não atendam as premissas de normalidade e homogeneidade de variâncias, podemos seguir com análise não-paramétrica. Testes não-paramétricos não consideram as premissas antes testadas e permitem que prossigamos com a análise dos dados.\n\nO teste de [Kruskal-Wallis](https://rcompanion.org/handbook/F_08.html) é um teste não paramétrico similar ao teste F. Portanto, o teste não separa os grupos. Para isso, após o teste apresentar que há pelo menos um par de tratamentos que se diferem estatisticamente entre si, é necessário adotar um teste Post Hoc, para comparações múltiplas. A função `kruskal.test()`, do pacote **stats**, realiza essa primeira parte. A função `kruskal()` do pacote **agricolae,** realiza essas duas etapas de uma vez. Caso queira, pode-se realizar testes Post Hoc como o teste de Dunn, teste de Nemenyi ou teste de Conover.\n\n```{r}\nkruskal.test(count ~ spray, data = insects)\n```\n\n```{r}\nm3 <- kruskal(insects$count, insects$spray, group = T)\nm3$groups\n```\n\n## Alternativa 3: Modelo linear generalizado (GLMs)\n\nOutra alternativa que se pode adotar, para análisar dados que não atenderam as premissas, é realizar ajustes de modelos não lineares, que permite indicar a qual distribuição os dados pertencem. A função `glm()` do pacote **stats**, ajusta esses modelos.\n\n```{r}\nm4 <- glm(count ~ spray, \n          family = poisson, # poisson por ser dados de contagem\n          data = insects)\nsummary(m4)\n\nlibrary(car)\nAnova(m4)\n\n```\n\nP-valor \\< 0,05, um indicativo que existe pelo menos uma média com diferença significativa. Agora para separar os grupos seguimos com testes de comparações múltiplas.\n\n```{r}\nmedias4 <-  emmeans(m4, ~ spray,\n                    type = \"response\")\ncld(medias4, Letters = letters)\n\n```\n\n# Anova Fatorial\n\nPartimos agora para análise de dados organizados em esquema fatorial.\n\n## Banco de dados\n\nDados referentes a um ensaio realizado em Delineamento Inteiramente Casualizado (DIC) em esquema fatorial 2x2. O primeiro fator, qualitativo, composto pelos níveis: Líquido iônico e Tebuconazol. O segundo fator, quantitativo, composto pelos níveis: 0,5 e 2. Avaliou-se o efeito dos tratamentos sobre a intensidade de uma doença qualquer.\n\n```{r}\ndados <- gsheet::gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=2023059672\")\n```\n\n## Gráfico\n\nVisualmente, é perceptível uma diferença do tratamento líquido iônico na concentração de 0,2 com os outros tratamentos.\n\n```{r}\ndados |> \n  ggplot(aes(factor(dose), x = treat, y = severity, color = factor(dose))) + \n  geom_jitter(size = 3, width = 0.2) +\n  theme_classic() + \n  labs(y = 'Severidade (%)', x = ' ', color = 'Doses') +\n  theme(text = element_text(size = 15))\n```\n\n# ANOVA e teste de comparações múltiplas\n\nVamos rodar os testes para verificar se realmente existe essa diferença detectada visualmente no gráfico. Nesse caso, ajustamos o modelo como se segue:\n\n```{r}\nmf <- lm(severity ~ treat*factor(dose), data = dados )\nanova(mf)\nplot(simulateResiduals(mf))\nmf_medias1 <- cld(emmeans(mf, ~ treat | dose))\nmf_medias2 <- cld(emmeans(mf, ~ dose | treat))\n\nmf_medias1; mf_medias2\n```\n\nComo visualizado no gráfico de dispersão, existe diferença entre os níveis de dose dentro do fator líquido iônico e diferença entre os níveis qualitativos dentro do nível 0,5 do fator dose. Concluindo que a aplicação do líquido iônico é equivalente a aplicação de fungicida tebuconazol quando aplicado na dose 2, sobre a redução da severidade da doença.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"Aula_6-7.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.555","editor":"visual","theme":{"light":"flatly","dark":"darkly"},"title":"Aula 6 e 7","massage":false},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}