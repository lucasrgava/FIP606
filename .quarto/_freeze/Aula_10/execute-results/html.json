{
  "hash": "952cd88b016013df79239e269a1aea02",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Aula 10\"\nformat: html\neditor: visual\n---\n\n\n# Pacotes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gsheet)\nlibrary(tidyverse)\nlibrary(patchwork)\nlibrary(AgroR)\nlibrary(drc)\nlibrary(ec50estimator)\n```\n:::\n\n\n# Correlação e Coeficiente de determinação\n\nA correlação é uma associação feita entre duas variáveis. Uma correlação muito conhecida é a correlação de Person. O Coeficiente de correlação (r) é a força da associação entre x e y. Os valores de **r** são admensionais e podem variar de -1 a 1. Quando:\n\n-   r = 1 ou r = -1: significa que existe forte correlação entre as duas variáveis. O valor negativo significa que existe uma relação inversa entre as variáveis e uma correlação positiva significa que há uma correlação direta, ou seja, a medida que o valor de uma variável aumenta a outra diminui e quando uma aumenta a outra também aumenta, respectivamente;\n\n-   r = 0: significa que não existe correlação entre as variáveis, ou seja, a variação de uma não interfere na variação da outra variável.\n\nMas não necessariamente os valores de r serão discretos, como apresentado acima, o valor de r é contínuo entre os extremos apresentados. Logo, para interpretar esses valores de correlação:\n\n-   **r \\> 0,7:** Positivo ou negativo, **CORRELAÇÃO** **FORTE**;\n\n-   **r entre 0,5 e 0,7:** Positivo ou negativo, **CORRELAÇÃO MODERADA**;\n\n-   **r entre 0,3 a 0,5:** Positivo ou negativo, **CORRELAÇÃO FRACA**;\n\n-   **r entre 0 e 0,3:** Positivo ou negativo, **CORRELAÇÃO DESPREZÍVEL**.\n\nO Coeficiente de Determinação (r\\^2), varia entre 0 e 1, e retrata o quanto de y é explicado pela variação de x. Seu cálculo é simples e resume-se em elevar o **r** ao quadrado.\n\n## Banco de dados\n\nOs dados se referem a medição da severidade de uma determinada doença na cultura da roseira, tomate, café e feijão, utilizando diferentes softwares, **Assess**, **LeafDoctor** e **ImageJ**, para determinar tal severidade.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados <- gsheet2tbl('https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=373270992')\n```\n:::\n\n\n### Gráfico\n\nAbaixo, seguimos com a eleboração de gráficos de dispersão, comparando duas variáveis e ajustando uma reta.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- dados |> \n  ggplot(aes(x = Assess,y = LeafDoctor)) +\n  geom_point(alpha = 0.7, size = 2) + \n  theme_classic() + \n  geom_smooth(method = 'lm', se = F, color = 'red') + \n  labs(y = 'Severidade (%) com Leaf Doctor',\n       x = 'Severidade (%) com Assess')\np2 <- dados |> \n  ggplot(aes(x = Assess, y = ImageJ)) +\n  geom_point(alpha = 0.7, size = 2) + \n  theme_classic() + \n  geom_smooth(method = 'lm', se = F, color = 'red') + \n  labs(y = 'Severidade (%) com ImageJ',\n       x = 'Severidade (%) com Assess')\n\np1 + p2\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Aula_10_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nÉ perceptível que existe uma correlação positiva entre os softweres confrontados.\n\n### Matriz de correlação\n\nUtilizando a função `corgraph()` do pacote **AgroR** é possível criar uma matriz de correlação. Como esperado existe forte correlação positiva entre as severidades mensuradas pelos softwares. Dessa forma, pode-se utilizar qualquer programa para calcular a severidade já que o Assess é pago.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimgs <- dados |> \n  dplyr::select(3:5)\n\ncorgraph(imgs)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        Var1       Var2       cor            p\n2 LeafDoctor     Assess 0.9666367 5.972544e-42\n3     ImageJ     Assess 0.9776918 8.143613e-48\n6     ImageJ LeafDoctor 0.9797478 3.144091e-49\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Aula_10_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncor.test(dados$Assess, dados$LeafDoctor)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPearson's product-moment correlation\n\ndata:  dados$Assess and dados$LeafDoctor\nt = 31.119, df = 68, p-value < 2.2e-16\nalternative hypothesis: true correlation is not equal to 0\n95 percent confidence interval:\n 0.9466882 0.9792005\nsample estimates:\n      cor \n0.9666367 \n```\n\n\n:::\n\n```{.r .cell-code}\ncor.test(dados$Assess, dados$ImageJ)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPearson's product-moment correlation\n\ndata:  dados$Assess and dados$ImageJ\nt = 38.383, df = 68, p-value < 2.2e-16\nalternative hypothesis: true correlation is not equal to 0\n95 percent confidence interval:\n 0.9642331 0.9861219\nsample estimates:\n      cor \n0.9776918 \n```\n\n\n:::\n:::\n\n\nOutro pacote interessante que monta uma matriz de correlação é o pacote **corrplot**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(corrplot)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'corrplot' was built under R version 4.3.3\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\ncorrplot 0.92 loaded\n```\n\n\n:::\n\n```{.r .cell-code}\ncor_img <- cor(imgs)\ncorrplot(cor_img, method = 'square', type = 'lower')\n```\n\n::: {.cell-output-display}\n![](Aula_10_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## Banco de dados\n\nRetornamos com banco de dados já utilizados em aulas anteriores. No banco, está contido variáveis respostas de produtividade, DFCs e severidade de ferrugem. O código a seguir, calcula a correlação entre as variáveis de doença e a variável produtividade. Já é de conhecimento comum, que, quanto mais uma cultura sofre danos devido ao ataque de doenças há um reflexo negativo na sua produtividade, ou seja, menor produtividade. Logo, com base nos cálculos a seguir, esperamos que as correlações sejam negativas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncampo <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=866852711\")\n\ncampo2 <- campo |> \n  dplyr::select(DFC, FER, PROD)\n\ncorgraph(campo2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Var1 Var2        cor            p\n2  FER  DFC  0.9316978 9.864101e-15\n3 PROD  DFC -0.6928161 1.110652e-05\n6 PROD  FER -0.6258321 1.277444e-04\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Aula_10_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\ndfc <- cor.test(campo2$PROD, campo2$DFC)\nfer <- cor.test(campo2$PROD, campo2$FER)\ndfc; fer\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPearson's product-moment correlation\n\ndata:  campo2$PROD and campo2$DFC\nt = -5.2623, df = 30, p-value = 1.111e-05\nalternative hypothesis: true correlation is not equal to 0\n95 percent confidence interval:\n -0.8388581 -0.4537361\nsample estimates:\n       cor \n-0.6928161 \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPearson's product-moment correlation\n\ndata:  campo2$PROD and campo2$FER\nt = -4.3949, df = 30, p-value = 0.0001277\nalternative hypothesis: true correlation is not equal to 0\n95 percent confidence interval:\n -0.7999565 -0.3544981\nsample estimates:\n       cor \n-0.6258321 \n```\n\n\n:::\n:::\n\n\nDe fato, as correlações entre as variáveis doenção versus produtividade foram negativas e moderadas.\n\nO código abaixo filtra os intervalos de confiança das correlações calculadas entre as variáveis de doenças versus produtividade.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndfc$conf.int[1:2]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] -0.8388581 -0.4537361\n```\n\n\n:::\n\n```{.r .cell-code}\nfer$conf.int[1:2]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] -0.7999565 -0.3544981\n```\n\n\n:::\n:::\n\n\n# Modelos Lineares\n\n## Banco de dados\n\nSeguimos com banco de dados de estande de plantas para ajuste de modelos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nestande <- gsheet2tbl('https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=401662555')\n```\n:::\n\n\n### Gráfico\n\nO gráfico abaixo, apresenta a dispersão dos dados e duas curvas, uma quadrática e outra linear aos dados. Veja:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nestande |> \n  filter(exp == 2) |> \n  ggplot(aes(trat, nplants)) +\n  geom_point() + \n  ylim(0, 100) +\n  geom_smooth(method = 'lm', se = F, formula = y ~ poly(x, 2), color = 'black') +\n  geom_smooth(method = 'lm', se = F) + \n  theme_classic() + \n  labs(y = 'Plants number',\n       x = 'Treatments')\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Aula_10_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n### Ajuste de modelo linear de 1° grau\n\nNa função `lm()`, ajustamos um modelo linear de primeira ordem, veja:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexp2 <- estande |> \n  filter(exp == 2)\nlm2 <-  lm(nplants ~trat, data = exp2)\nsummary(lm2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = nplants ~ trat, data = exp2)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-25.7816  -7.7150   0.5653   8.1929  19.2184 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  60.9857     3.6304  16.798 4.93e-14 ***\ntrat         -0.7007     0.1605  -4.365 0.000247 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 12.95 on 22 degrees of freedom\nMultiple R-squared:  0.4641,\tAdjusted R-squared:  0.4398 \nF-statistic: 19.05 on 1 and 22 DF,  p-value: 0.0002473\n```\n\n\n:::\n\n```{.r .cell-code}\nhist(residuals(lm2))\n```\n\n::: {.cell-output-display}\n![](Aula_10_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n### Ajuste de modelo linear de 2° grau\n\nObserve que foi criada mais uma coluna com valores elevados ao quadrado. No modelo, a variável elevada é acrescida por meio de simbolo \"**+**\". Seguimos com um resumo do modelo, utilizando a função `summary()`, onde verificamos os valores dos coeficientes da regressão e seu intercepto. Posteriormente, calculou-se o Critério de Akaike, pela função `AIC()`, utilizado para comparar diferentes modelos e selecionar o melhor. Significa dizer que, quanto menor o valor de AIC, melhor é o modelo.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexp2$trat2 <- exp2$trat^2\n\nlm3 <- lm(nplants ~ trat + trat2, data = exp2)\nsummary(lm3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = nplants ~ trat + trat2, data = exp2)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-25.439  -6.019   1.789   8.016  19.561 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 66.30156    4.42097  14.997 1.08e-12 ***\ntrat        -1.77720    0.58467  -3.040  0.00623 ** \ntrat2        0.02223    0.01166   1.906  0.07036 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 12.24 on 21 degrees of freedom\nMultiple R-squared:  0.5432,\tAdjusted R-squared:  0.4997 \nF-statistic: 12.49 on 2 and 21 DF,  p-value: 0.0002675\n```\n\n\n:::\n\n```{.r .cell-code}\nAIC(lm3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 193.1284\n```\n\n\n:::\n:::\n\n\nA função, `polynomial()`, do pacote **AgroR,** em conjunto com o código abaixo permite plotar a curva ajustada ao grau de interesse, com os pontos e a equação. Veja:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwith(exp2, polynomial(trat, nplants, grau = 2)) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n----------------------------------------------------\nRegression Models\n----------------------------------------------------\n               Estimate Std. Error   t value     Pr(>|t|)\n(Intercept) 66.30156250 4.42096799 14.997069 1.079972e-12\ntrat        -1.77719814 0.58467380 -3.039640 6.230050e-03\nI(trat^2)    0.02222876 0.01165948  1.906496 7.036247e-02\n\n----------------------------------------------------\nDeviations from regression\n----------------------------------------------------\n          Df       SSq       MSQ         F      p-value\nLinear     1 3196.2031 3196.2031 21.823293 0.0001899378\nQuadratic  1  544.5029  544.5029  3.717801 0.0697619482\nDeviation  3  509.6690  169.8897  1.159986 0.3523240106\nResidual  18 2636.2500  146.4583                       \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Aula_10_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n# Modelos Não-lineares\n\n## Banco de dados\n\nO próximo banco de dados que iremos utilizar a seguir, refere-se a dados de sensibilidade a fungicidas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngerminacao <- gsheet2tbl('https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=465348652')\n```\n:::\n\n\n## Gráfico\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngerm <- germinacao |> \n  group_by(code, state, dose) |> \n  dplyr::select(-replicate) |> \n  summarise(mean_germ = mean(germination), .groups = 'drop')\n\ngerm |> \n  ggplot(aes(dose, mean_germ)) + \n  geom_point() +\n  facet_wrap(~code) + \n  geom_smooth(method = 'lm', se = F, formula = y ~ poly(x, 2))\n```\n\n::: {.cell-output-display}\n![](Aula_10_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\nSensibilidade a fungicida dos isolados por estado:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngerm |> \n  ggplot(aes(dose, mean_germ)) + \n  geom_point() +\n  facet_wrap(~state) + \n  geom_smooth(method = 'lm', se = F, formula = y ~ poly(x, 2))\n```\n\n::: {.cell-output-display}\n![](Aula_10_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n## Ajuste do modelo\n\nNo código abaixo, utilizamos a função `drm()` do pacote **drc**, para ajutar modelos não lineares. O argumento *`fct =`* permite que seja definido qual modelo não linear seja ajustado. Para mais sobre o uso da função execute o comando no console: `?drm`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nisolado.x <- germ |> \n  filter(code == 152)\n\ndrc1 <- drm(mean_germ ~ dose, data = isolado.x, fct = LL.3())\nAIC(drc1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 32.57898\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(drc1)\n```\n\n::: {.cell-output-display}\n![](Aula_10_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n\n```{.r .cell-code}\nED(drc1, 50, interval = 'delta')\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nEstimated effective doses\n\n       Estimate Std. Error    Lower    Upper\ne:1:50 0.444356   0.077789 0.196796 0.691916\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(drc1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nModel fitted: Log-logistic (ED50 as parameter) with lower limit at 0 (3 parms)\n\nParameter estimates:\n\n               Estimate Std. Error t-value   p-value    \nb:(Intercept)  5.526512   7.765348  0.7117 0.5280076    \nd:(Intercept) 45.250173   1.876343 24.1162 0.0001563 ***\ne:(Intercept)  0.444356   0.077789  5.7123 0.0106434 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error:\n\n 2.65351 (3 degrees of freedom)\n```\n\n\n:::\n:::\n\n\n## Determinação da EC50\n\nA determinação da EC50 é muito utilizada quando se trabalha com produtos destinados ao manejo de pragas e doenças. Corresponde a concentração do produto capaz de inibir 50%, por exemplo, da população, do desenvolvimento de um fungo ou no índice de germinação de esporos.\n\nUm pacote que já possui funções para realizar esses cálculos é o pacote **ec50estimator**, com a função `estimate_EC50()`. Nesse caso, determinou-se a EC50 sobre a germinação de esporos para cada isolado, com ajuste de modelo logístico no argumento *`fct =`*. Com base no resultado conseguimos identificar que o isolado FGT05 foi o mais sensível ao fungicida testado.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_ec50 <- estimate_EC50(mean_germ ~ dose,\n                         data = germ,\n                         isolate_col = \"code\",\n                         interval = \"delta\",\n                         fct = drc ::LL.3())\ndf_ec50 |> \n  arrange(Estimate)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      ID strata   Estimate  Std..Error        Lower     Upper\n1  FGT05        0.04483862 0.019290890 -0.016553601 0.1062308\n2  FGT33        0.10481627 0.013065221  0.063236910 0.1463956\n3    169        0.14722311 0.009555688  0.116812646 0.1776336\n4  FGT34        0.14773114 0.047003373 -0.001854568 0.2973169\n5    188        0.15297172 0.004284691  0.139335920 0.1666075\n6  FGT35        0.20315392 0.038984604  0.079087515 0.3272203\n7    153        0.20379664 0.042373512  0.068945217 0.3386481\n8    187        0.21563338 0.036639446  0.099030315 0.3322365\n9  FGT28        0.22608141 0.033600742  0.119148854 0.3330140\n10 FGT29        0.23601652 0.034933881  0.124841318 0.3471917\n11   170        0.37503889 0.043207328  0.237533889 0.5125439\n12   152        0.44435629 0.077789240  0.196796213 0.6919164\n13 FGT42        0.45000559 0.059685890  0.260058448 0.6399527\n14 FGT43        0.49589549 0.060850771  0.302241178 0.6895498\n15   164        0.50775844 0.047248266  0.357393370 0.6581235\n16   189        0.53106193 0.023130936  0.457448972 0.6046749\n17 FGT06        0.54497946 0.034834602  0.434120211 0.6558387\n18   165        0.55839613 0.114195113  0.194976315 0.9218159\n19   186        0.57975744 0.013332268  0.537328208 0.6221867\n20 FGT07        0.88770053 0.079917704  0.633366725 1.1420343\n```\n\n\n:::\n:::\n",
    "supporting": [
      "Aula_10_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}