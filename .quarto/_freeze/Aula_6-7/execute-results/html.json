{
  "hash": "c06d9458bc574169b51508629c5b2a31",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Aula 6 e 7\"\nformat: html\neditor: visual\nmassage: false\nwarning: false\n---\n\n\n# Objetivo\n\nAprender a realizar Análise de Variância (ANOVA) e testar suas premissas, testes de comparações múltiplas, transformações de dados, testes não-paramétricos, Modelos Lineares Generalizados (GLMs) e Anova Fatorial.\n\n# Pacotes\n\nPacotes requeridos no decorrer do código.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)    # Manipulação de dados\nlibrary(report)       # possui uma função interessante para retornar o um resumo do                         resultado estatístico\nlibrary(emmeans)\nlibrary(multcomp)\nlibrary(multcompView)\nlibrary(DHARMa)\nlibrary(performance)  # Testar as premissas\nlibrary(agricolae)\n```\n:::\n\n\n# Banco de dados: Dois grupos independentes\n\nO banco de dados é constituído por dois tratamentos, controle e Mg e uma variável resposta '*comp'*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados <- gsheet::gsheet2tbl(url = 'https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=983033137')\n```\n:::\n\n\n## Gráfico\n\nVisualizando os dados dos tratamentos por meio de Boxplot. Já é possível inferir que há diferença entre os tratamentos. Para ter certeza se essa diferença realmente existe, vamos seguir analisando.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados |> \n  ggplot(aes(trat, comp)) +\n  geom_boxplot(fill = 'lightblue') + \n  labs(x = 'Treatments') +\n  theme_classic() +\n  labs(y = 'Comprimento')\n```\n\n::: {.cell-output-display}\n![](Aula_6-7_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n## Teste t de Student\n\nO teste t de Student é um teste de análise paramétrica e pode ser dividido em três tipos:\n\n-   Teste t de **amostras independentes**: Quando se deseja comparar diferença entre médias de dois tratamentos;\n\n-   Teste t de **amostras dependentes** ou pareadas: Quando se deseja comparar diferenças sobre um mesmo grupo antes e depois da aplicação do tratamento;\n\n-   Teste t de **uma amostra**: Quando se deseja comparar a média do grupo com uma determinado valor conhecido.\n\nReestruturando banco de dados para o formato largo e realizando o teste t utilizando as funções `pivot_wider()` e `t.test()` dos pacotes **tidyr** e **stats**, respectivamente. Por fim, a função `report()`, do pacote **report,** retorna um resumo do resultado do teste. De maneira geral, o teste apresentou diferença significativa entre os dois tratamentos com p-valor \\< 0,05.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados <- dados |> \n  pivot_wider(names_from = trat, values_from = comp)\n\nteste <- t.test(dados$Mg2, dados$control)\nreport(teste)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEffect sizes were labelled following Cohen's (1988) recommendations.\n\nThe Welch Two Sample t-test testing the difference between dados$Mg2 and\ndados$control (mean of x = 10.52, mean of y = 15.68) suggests that the effect\nis negative, statistically significant, and large (difference = -5.16, 95% CI\n[-6.49, -3.83], t(17.35) = -8.15, p < .001; Cohen's d = -3.65, 95% CI [-5.12,\n-2.14])\n```\n\n\n:::\n:::\n\n\n## Premissas\n\nAntes de prosseguir com análise paramétrica dos dados, é necessário que os dados atendam as premissas de **Normalidade dos Dados** e **Homogeneidade de Variâncias**.\n\n### Normalidade\n\nO teste de normalidade adotado aqui é o teste de **Shapiro-Wilk**. Existem outros testes de normalidade que podem ser utilizados. No entanto, esse teste é considerado o mais poderoso entre os testes. Pode ser feito da seguinte maneira:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshapiro.test(dados$Mg2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  dados$Mg2\nW = 0.97269, p-value = 0.9146\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshapiro.test(dados$control)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  dados$control\nW = 0.93886, p-value = 0.5404\n```\n\n\n:::\n:::\n\n\nObserve que a normalidade foi testada para cada tratamento e o p-valor \\> 0,05. Dessa maneira, não se rejeita a hipótese nula (H0), que os dados são normais.\n\n#### Gráfico de normalidade\n\nO código abaixo, apresenta graficamente a normalidade dos dados. Nesse caso, testamos a normalidade para o vetor de valores do tratamento Mg. A interpretação do gráfico é que quanto mais próximo os pontos estão da reta, ou, quanto menor esse erro dos pontos em relação a reta, mais próximo da normalidade estão os dados.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqqnorm(dados$Mg2)\nqqline(dados$Mg2)\n```\n\n::: {.cell-output-display}\n![](Aula_6-7_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n### Homogeneidade de variâncias\n\nA função `var.test()` do pacote **stats** pode ser utilizada para análise de variâncias. A função pede como argumento basicamente 2 vetores numéricos, cada um com os valores da variável resposta de cada um dos tratamentos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvar.test(dados$Mg2, dados$control)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tF test to compare two variances\n\ndata:  dados$Mg2 and dados$control\nF = 1.4781, num df = 9, denom df = 9, p-value = 0.5698\nalternative hypothesis: true ratio of variances is not equal to 1\n95 percent confidence interval:\n 0.3671417 5.9508644\nsample estimates:\nratio of variances \n          1.478111 \n```\n\n\n:::\n:::\n\n\nCaso as variâncias não sejam homogêneas, pode-se acrescentar o argumento:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nt.test(dados$Mg2, dados$control, var.equal = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWelch Two Sample t-test\n\ndata:  dados$Mg2 and dados$control\nt = -8.1549, df = 17.354, p-value = 2.423e-07\nalternative hypothesis: true difference in means is not equal to 0\n95 percent confidence interval:\n -6.490393 -3.825607\nsample estimates:\nmean of x mean of y \n   10.520    15.678 \n```\n\n\n:::\n:::\n\n\nAcabamos de verificar as premissas de normalidade dos dados e homogeneidade das variâncias.\n\n# Banco de dados: Dois grupos com dependência\n\nOs dados que trabalharemos agora são referentes a avaliações de intensidade de doença sem e com auxílio de escala diagramática. Nesse caso, os dados são coletados sobre o mesmo avaliador em momentos diferentes. No primeiro momento, o avaliador não faz uso de escala. No segundo momento, o avaliador faz uso de escala. O objetivo aqui é analisar se há ganho em acurácia e precisão quando se adota a escala comparado a quando não há. Nesse sentido, dizemos que existe dependência entre os dados e seguimos com teste t pareado.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados2 <- gsheet::gsheet2tbl('https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=1729131173')\n```\n:::\n\n\n## Gráfico\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados2 |> \n  ggplot(aes(assessment, acuracia)) +\n  geom_boxplot(fill = 'lightblue') + \n  labs(y = \"Acurácia\",\n       x = 'Avaliação') +\n  theme_classic() +\n  theme(text = element_text(size = 15)) \n```\n\n::: {.cell-output-display}\n![](Aula_6-7_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n## Teste t pareado\n\nSeguindo o mesmo raciocínio utilizado no banco de dados anterior, para este, também será ajustado para o formato largo antes de seguir com a análise.\n\nPara realizar o teste entre grupos pareados (dependentes), basta acrescentar o argumento `paired = TRUE` dentro da função `t.test()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados2 <- dados2 |> \n  dplyr::select(rater, assessment, acuracia)\n\ndados2 <-  dados2 |> \n  pivot_wider(names_from = assessment, values_from = acuracia)\n\n\nt.test(dados2$Unaided, dados2$Aided1, paired = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPaired t-test\n\ndata:  dados2$Unaided and dados2$Aided1\nt = -4.4214, df = 9, p-value = 0.001668\nalternative hypothesis: true mean difference is not equal to 0\n95 percent confidence interval:\n -0.3552353 -0.1147647\nsample estimates:\nmean difference \n         -0.235 \n```\n\n\n:::\n:::\n\n\nO p-valor \\< 0,05, rejeita-se H0 e aceita-se a hipótese alternativa (Ha), ou seja, existe diferença significativa entre os grupos de médias ao nível de 5% de probabilidade, pelo teste t pareado. Agora, é preciso verificar as premissas antes de aceitar este resultado como verdade.\n\n## Premissas\n\n### Normalidade\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshapiro.test(dados2$Unaided)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  dados2$Unaided\nW = 0.7748, p-value = 0.007155\n```\n\n\n:::\n\n```{.r .cell-code}\nshapiro.test(dados2$Aided1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  dados2$Aided1\nW = 0.92852, p-value = 0.4335\n```\n\n\n:::\n:::\n\n\nPelo menos um dos grupos não apresentou normalidade dos dados.\n\n### Homogeneidade de variâncias\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvar.test(dados2$Unaided, dados2$Aided1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tF test to compare two variances\n\ndata:  dados2$Unaided and dados2$Aided1\nF = 20.978, num df = 9, denom df = 9, p-value = 0.000106\nalternative hypothesis: true ratio of variances is not equal to 1\n95 percent confidence interval:\n  5.210754 84.459185\nsample estimates:\nratio of variances \n          20.97847 \n```\n\n\n:::\n:::\n\n\nAs variâncias não podem ser consideradas homogêneas. P-valor \\> 0,05. Os dados foram submetidos a transformações e mesmo assim não atenderam as premissas. Nesse caso, para prosseguir com a análise dos dados é preciso partir para análise não paramétrica, que será abordada mais adiante.\n\nNo entanto, supondo que os dados são normais e apenas a premissa de homogeneidade de variâncias não foi atendida, pode-se seguir com a análise do teste t indicando o argumento *`var.equal = FALSE`* dentro da função `t.test()`. Esse teste é uma variação do teste t e é conhecido com teste t de Welch.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nt.test(dados2$Unaided, dados2$Aided1, paired = TRUE, var.equal = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPaired t-test\n\ndata:  dados2$Unaided and dados2$Aided1\nt = -4.4214, df = 9, p-value = 0.001668\nalternative hypothesis: true mean difference is not equal to 0\n95 percent confidence interval:\n -0.3552353 -0.1147647\nsample estimates:\nmean difference \n         -0.235 \n```\n\n\n:::\n:::\n\n\n# Teste não-paramétrico\n\nSeguindo com a análise do conjunto de dados anterior, adotar teste não-paramétrico é uma alternativa para seguir com as análises quando as premissas dos testes paramétricos não são atendidas.\n\n## Wilcoxon Signed-Rank\n\nEsse teste é uma alternativa não-paramétrica para análise de dados pareados que não apresentam normalidade. Utilizando a função `wilcox.test()` e definindo o argumento *`paired = TRUE`\"*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwilcox.test(dados2$Aided1,\n            dados2$Unaided,\n            paired = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWilcoxon signed rank test with continuity correction\n\ndata:  dados2$Aided1 and dados2$Unaided\nV = 55, p-value = 0.005889\nalternative hypothesis: true location shift is not equal to 0\n```\n\n\n:::\n:::\n\n\nO p-valor \\< 0,05, indicando que existe diferença entre os tratamentos pelo referido teste.\n\n# Banco de dados: Três ou mais grupos\n\nAgora vamos seguir para analisar dados cujas comparações são entre três ou mais grupos. Os dados importados abaixo são referentes a um ensaio conduzido num Delineamento experimental Inteiramente Casualizado (DIC), com 5 tratamentos (espécies) e 6 repetições com apenas uma variável resposta.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados3 <- gsheet::gsheet2tbl('https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=959387827')\n```\n:::\n\n\n## Gráfico\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados3 |> \n  ggplot(aes(especie, tcm)) +\n  geom_boxplot(fill = 'grey') +\n  geom_jitter(width = 0.1, size = 2.5, alpha = 0.7, color = 'darkred') +\n  labs(x = 'Espécies') +\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![](Aula_6-7_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n## ANOVA\n\nA ANOVA (Análise de Variância), identifica a existência de pelo menos uma média com diferença significativa entre as demais. No entanto, ela por si só, não indica quais médias são diferentes entre si. A hipótese testada é que as médias são iguais. O quadro de ANOVA retorna o p-valor e este sendo menor que o nível de significancia adotado pelo pesquisador, rejeita-se a H0 e aceita-se a Ha. Para realizar essa análise no R, pode-se seguir com as funções `anova()` e `lm()` do pacote **stats**. Para entender melhor sobre como utilizar essas funções e seus argumentos, busque ajuda digitando no console *`?NOME DA FUNÇÃO`*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanova(lm(tcm ~ especie, data = dados3))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: tcm\n          Df  Sum Sq Mean Sq F value    Pr(>F)    \nespecie    4 1.46958 0.36739  19.629 2.028e-07 ***\nResiduals 25 0.46792 0.01872                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\nO resultado do Quadro da ANOVA indicou que existe pelo menos uma média, entre os tratamentos, que se diferem entre si ao nível de 5% de significância.\n\n## Teste de comparações múltiplas\n\nUtilizando a função `emmeans()` e `cld()` para separar os grupos de médias estatisticamente diferentes entre si.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1 <- lm(tcm ~ especie, data = dados3)\nmedias1 <-  emmeans(m1, ~ especie)\ncld(medias1, Letters = letters)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n especie emmean     SE df lower.CL upper.CL .group\n Fgra     0.912 0.0559 25    0.797     1.03  a    \n Faus     1.237 0.0559 25    1.122     1.35   b   \n Fcor     1.322 0.0559 25    1.207     1.44   b   \n Fmer     1.427 0.0559 25    1.312     1.54   bc  \n Fasi     1.572 0.0559 25    1.457     1.69    c  \n\nConfidence level used: 0.95 \nP value adjustment: tukey method for comparing a family of 5 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n:::\n\n\n## Premissas: normalidades dos resíduos\n\nA seguir, três maneiras de verificar as premissas.\n\n-   **Primeira maneira**: Utilizando as funções `shapiro.test()` e `bartlett.test()`.\n\nOs resíduos são normais e as variâncias são homeogêneas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshapiro.test(m1$residuals)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  m1$residuals\nW = 0.9821, p-value = 0.8782\n```\n\n\n:::\n\n```{.r .cell-code}\nbartlett.test(tcm ~ especie, data = dados3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tBartlett test of homogeneity of variances\n\ndata:  tcm by especie\nBartlett's K-squared = 4.4367, df = 4, p-value = 0.3501\n```\n\n\n:::\n:::\n\n\n-   **Segunda maneira:** Realizando o plot do resultado da função `simulateResiduals()` do modelo ajustado, nesse caso, 'm1'. Os resíduos são normais e as variências homogêneas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(simulateResiduals(m1))\n```\n\n::: {.cell-output-display}\n![](Aula_6-7_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\n-   **Terceira maneira:** Utilizando aa fuções `check_normality()` e `check_heteroscedasticity()` do pacote **Performance**, para verificar a normalidade dos resíduos e homeogeneidade das variâncias, respectivamente.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncheck_normality(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOK: residuals appear as normally distributed (p = 0.878).\n```\n\n\n:::\n\n```{.r .cell-code}\ncheck_heteroscedasticity(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOK: Error variance appears to be homoscedastic (p = 0.880).\n```\n\n\n:::\n\n```{.r .cell-code}\nplot <- check_model(m1)\n```\n:::\n\n\n# Banco de dados\n\nO banco de dados contêm 6 tratamentos com 12 repetições cada.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninsects <- InsectSprays\ninsects |> count(spray)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  spray  n\n1     A 12\n2     B 12\n3     C 12\n4     D 12\n5     E 12\n6     F 12\n```\n\n\n:::\n:::\n\n\n## Gráfico\n\nApenas com base no gráfico abaixo, podemos inferir que existe tratamentos que diferem entre si sobre a variável contagem. Vamos realizar os teste estatísticos para ter certeza disso.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninsects |> \n  ggplot(aes(x = spray, y = count)) +\n  geom_boxplot(outlier.colour = NA, fill = 'lightblue') +\n  geom_jitter(width = 0.05, color = 'gray') + \n  labs(x = 'Spray', y = 'Contagem') +  \n  theme_classic()\n```\n\n::: {.cell-output-display}\n![](Aula_6-7_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n\n## ANOVA\n\nEsses dados são referentes a um ensaio realizado em Delineamento Inteiramente Casualizado (DIC). Logo, o ajuste do modelo, para rodar a ANOVA, é simples. Como apresentado no código abaixo:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nml <- lm(count ~ spray, \n         data = insects)\nanova(ml)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: count\n          Df Sum Sq Mean Sq F value    Pr(>F)    \nspray      5 2668.8  533.77  34.702 < 2.2e-16 ***\nResiduals 66 1015.2   15.38                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\nO p-valor \\< 0,05, ou seja, existe pelo menos um par de médias que se diferem entre si, pelo teste F, ao nível de 5% de probabilidade.\n\n## Gráfico: Histograma dos resíduos\n\nCom base no gráfico abaixo, é perceptível que os resíduos têm uma distribuição normal. Seguimos agora com um teste de normalidade para confirmar essa ideia.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninsects |> \n  ggplot(aes(x = ml$residuals)) +\n  geom_histogram(bins = 10, color = 'white', fill = 'lightblue') + \n  labs(x = 'Resíduos') +\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![](Aula_6-7_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshapiro.test(ml$residuals)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  ml$residuals\nW = 0.96006, p-value = 0.02226\n```\n\n\n:::\n:::\n\n\nO teste indica não normalidade dos dados, apesar de visualmente o histograma apresentar uma certa normalidade. Vale lembrar que a homogeneidade das variâncias é mais importanque que a normalidade dos resíduos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbartlett.test(count ~ spray, \n              data = insects)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tBartlett test of homogeneity of variances\n\ndata:  count by spray\nBartlett's K-squared = 25.96, df = 5, p-value = 9.085e-05\n```\n\n\n:::\n:::\n\n\nDe acordo com o teste de Bartlett os dados possuem variâncias heterogêneas. Resumindo, não é possível aplicar estatística paramétrica. Parte-se agora para transformação de dados para verificar se é possível trabalhar com estatística paramétrica com esses dados.\n\nQuando os dados são de contagem, normalmente a transformação com base na raiz quadrada é interessante.\n\n## Alternativa 1: transformação\n\n### Transformação por raiz quadrada\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninsects <- insects |> \n  mutate(count2 = sqrt(count))\n\ninsects |> \n  ggplot(aes(x = spray, y = count2)) +\n  geom_boxplot(fill = 'lightblue') +\n  theme_classic() +\n  labs(y = 'Count \\n (transformação pela raiz quadrada)', x = 'Spray')\n```\n\n::: {.cell-output-display}\n![](Aula_6-7_files/figure-html/unnamed-chunk-30-1.png){width=672}\n:::\n:::\n\n\nSeguimos agora para testar as premissas utilizando os dados transformados.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nml <- lm(count2 ~ spray,\n         data = insects)\nanova(ml)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: count2\n          Df Sum Sq Mean Sq F value    Pr(>F)    \nspray      5 88.438 17.6876  44.799 < 2.2e-16 ***\nResiduals 66 26.058  0.3948                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\n# Uma maneira de testear as premissas\nshapiro.test(ml$residuals)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  ml$residuals\nW = 0.98721, p-value = 0.6814\n```\n\n\n:::\n\n```{.r .cell-code}\nbartlett.test(count2 ~ spray,\n              data = insects)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tBartlett test of homogeneity of variances\n\ndata:  count2 by spray\nBartlett's K-squared = 3.7525, df = 5, p-value = 0.5856\n```\n\n\n:::\n\n```{.r .cell-code}\n# Outra maneira de testar as premissas\ncheck_normality(ml)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOK: residuals appear as normally distributed (p = 0.681).\n```\n\n\n:::\n\n```{.r .cell-code}\ncheck_heteroscedasticity(ml)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOK: Error variance appears to be homoscedastic (p = 0.854).\n```\n\n\n:::\n:::\n\n\nPremissas atendidas com a transformação por raiz quadrada. Partimos para testes de comparações múltiplas:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmedias1 <-  emmeans(ml, ~ spray)\ncld(medias1, Letters = letters)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n spray emmean    SE df lower.CL upper.CL .group\n C       1.24 0.181 66    0.883     1.61  a    \n E       1.81 0.181 66    1.447     2.17  ab   \n D       2.16 0.181 66    1.802     2.53   b   \n A       3.76 0.181 66    3.399     4.12    c  \n B       3.88 0.181 66    3.514     4.24    c  \n F       4.02 0.181 66    3.656     4.38    c  \n\nConfidence level used: 0.95 \nP value adjustment: tukey method for comparing a family of 6 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n:::\n\n\nConcluimos que os fungicidas C e E são os mais eficazes.\n\n### Transformação Box-Cox\n\nOutra maneira de transformar os dados é por meio da transformação de Box-Cox. Para isso, primeiro é preciso encontrar o lambda.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(MASS)\n\nb <-  boxcox(lm(insects$count + 0.1 ~ 1))\n```\n\n::: {.cell-output-display}\n![](Aula_6-7_files/figure-html/unnamed-chunk-33-1.png){width=672}\n:::\n\n```{.r .cell-code}\nlambda <- b$x[which.max(b$y)]\nlambda\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.4242424\n```\n\n\n:::\n:::\n\n\nCriando a variável transformada conforme a equação:\n\n-   y(lambda) = (x\\^lambda - 1) / lambda.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninsects$count3 <- (insects$count ^ lambda - 1) / lambda\n```\n:::\n\n\n## Alternativa 2: Teste não paramétrico\n\nCaso, após as transformações, os dados ainda não atendam as premissas de normalidade e homogeneidade de variâncias, podemos seguir com análise não-paramétrica. Testes não-paramétricos não consideram as premissas antes testadas e permitem que prossigamos com a análise dos dados.\n\nO teste de [Kruskal-Wallis](https://rcompanion.org/handbook/F_08.html) é um teste não paramétrico similar ao teste F. Portanto, o teste não separa os grupos. Para isso, após o teste apresentar que há pelo menos um par de tratamentos que se diferem estatisticamente entre si, é necessário adotar um teste Post Hoc, para comparações múltiplas. A função `kruskal.test()`, do pacote **stats**, realiza essa primeira parte. A função `kruskal()` do pacote **agricolae,** realiza essas duas etapas de uma vez. Caso queira, pode-se realizar testes Post Hoc como o teste de Dunn, teste de Nemenyi ou teste de Conover.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkruskal.test(count ~ spray, data = insects)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tKruskal-Wallis rank sum test\n\ndata:  count by spray\nKruskal-Wallis chi-squared = 54.691, df = 5, p-value = 1.511e-10\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nm3 <- kruskal(insects$count, insects$spray, group = T)\nm3$groups\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  insects$count groups\nF      55.62500      a\nB      54.83333      a\nA      52.16667      a\nD      25.58333      b\nE      19.33333     bc\nC      11.45833      c\n```\n\n\n:::\n:::\n\n\n## Alternativa 3: Modelo linear generalizado (GLMs)\n\nOutra alternativa que se pode adotar, para análisar dados que não atenderam as premissas, é realizar ajustes de modelos não lineares, que permite indicar a qual distribuição os dados pertencem. A função `glm()` do pacote **stats**, ajusta esses modelos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm4 <- glm(count ~ spray, \n          family = poisson, # poisson por ser dados de contagem\n          data = insects)\nsummary(m4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = count ~ spray, family = poisson, data = insects)\n\nCoefficients:\n            Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  2.67415    0.07581  35.274  < 2e-16 ***\nsprayB       0.05588    0.10574   0.528    0.597    \nsprayC      -1.94018    0.21389  -9.071  < 2e-16 ***\nsprayD      -1.08152    0.15065  -7.179 7.03e-13 ***\nsprayE      -1.42139    0.17192  -8.268  < 2e-16 ***\nsprayF       0.13926    0.10367   1.343    0.179    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 409.041  on 71  degrees of freedom\nResidual deviance:  98.329  on 66  degrees of freedom\nAIC: 376.59\n\nNumber of Fisher Scoring iterations: 5\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(car)\nAnova(m4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table (Type II tests)\n\nResponse: count\n      LR Chisq Df Pr(>Chisq)    \nspray   310.71  5  < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\nP-valor \\< 0,05, um indicativo que existe pelo menos uma média com diferença significativa. Agora para separar os grupos seguimos com testes de comparações múltiplas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmedias4 <-  emmeans(m4, ~ spray,\n                    type = \"response\")\ncld(medias4, Letters = letters)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n spray  rate    SE  df asymp.LCL asymp.UCL .group\n C      2.08 0.417 Inf      1.41      3.08  a    \n E      3.50 0.540 Inf      2.59      4.74  ab   \n D      4.92 0.640 Inf      3.81      6.35   b   \n A     14.50 1.099 Inf     12.50     16.82    c  \n B     15.33 1.130 Inf     13.27     17.72    c  \n F     16.67 1.179 Inf     14.51     19.14    c  \n\nConfidence level used: 0.95 \nIntervals are back-transformed from the log scale \nP value adjustment: tukey method for comparing a family of 6 estimates \nTests are performed on the log scale \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n:::\n\n\n# Anova Fatorial\n\nPartimos agora para análise de dados organizados em esquema fatorial.\n\n## Banco de dados\n\nDados referentes a um ensaio realizado em Delineamento Inteiramente Casualizado (DIC) em esquema fatorial 2x2. O primeiro fator, qualitativo, composto pelos níveis: Líquido iônico e Tebuconazol. O segundo fator, quantitativo, composto pelos níveis: 0,5 e 2. Avaliou-se o efeito dos tratamentos sobre a intensidade de uma doença qualquer.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados <- gsheet::gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=2023059672\")\n```\n:::\n\n\n## Gráfico\n\nVisualmente, é perceptível uma diferença do tratamento líquido iônico na concentração de 0,2 com os outros tratamentos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados |> \n  ggplot(aes(factor(dose), x = treat, y = severity, color = factor(dose))) + \n  geom_jitter(size = 3, width = 0.2) +\n  theme_classic() + \n  labs(y = 'Severidade (%)', x = ' ', color = 'Doses') +\n  theme(text = element_text(size = 15))\n```\n\n::: {.cell-output-display}\n![](Aula_6-7_files/figure-html/unnamed-chunk-40-1.png){width=672}\n:::\n:::\n\n\n# ANOVA e teste de comparações múltiplas\n\nVamos rodar os testes para verificar se realmente existe essa diferença detectada visualmente no gráfico. Nesse caso, ajustamos o modelo como se segue:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmf <- lm(severity ~ treat*factor(dose), data = dados )\nanova(mf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: severity\n                   Df   Sum Sq  Mean Sq F value    Pr(>F)    \ntreat               1 0.113232 0.113232  30.358 4.754e-05 ***\nfactor(dose)        1 0.073683 0.073683  19.755 0.0004077 ***\ntreat:factor(dose)  1 0.072739 0.072739  19.502 0.0004326 ***\nResiduals          16 0.059678 0.003730                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(simulateResiduals(mf))\n```\n\n::: {.cell-output-display}\n![](Aula_6-7_files/figure-html/unnamed-chunk-41-1.png){width=672}\n:::\n\n```{.r .cell-code}\nmf_medias1 <- cld(emmeans(mf, ~ treat | dose))\nmf_medias2 <- cld(emmeans(mf, ~ dose | treat))\n\nmf_medias1; mf_medias2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ndose = 0.5:\n treat        emmean     SE df lower.CL upper.CL .group\n Tebuconazole 0.0210 0.0273 16 -0.03690   0.0789  1    \n Ionic liquid 0.2921 0.0273 16  0.23420   0.3500   2   \n\ndose = 2.0:\n treat        emmean     SE df lower.CL upper.CL .group\n Tebuconazole 0.0202 0.0273 16 -0.03768   0.0781  1    \n Ionic liquid 0.0501 0.0273 16 -0.00781   0.1080  1    \n\nConfidence level used: 0.95 \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntreat = Ionic liquid:\n dose emmean     SE df lower.CL upper.CL .group\n  2.0 0.0501 0.0273 16 -0.00781   0.1080  1    \n  0.5 0.2921 0.0273 16  0.23420   0.3500   2   \n\ntreat = Tebuconazole:\n dose emmean     SE df lower.CL upper.CL .group\n  2.0 0.0202 0.0273 16 -0.03768   0.0781  1    \n  0.5 0.0210 0.0273 16 -0.03690   0.0789  1    \n\nConfidence level used: 0.95 \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n:::\n\n\nComo visualizado no gráfico de dispersão, existe diferença entre os níveis de dose dentro do fator líquido iônico e diferença entre os níveis qualitativos dentro do nível 0,5 do fator dose. Concluindo que a aplicação do líquido iônico é equivalente a aplicação de fungicida tebuconazol quando aplicado na dose 2, sobre a redução da severidade da doença.\n",
    "supporting": [
      "Aula_6-7_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}